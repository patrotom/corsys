/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 14.1 		*/
/*  Created On : 25-nov-2018 21:59:00 				*/
/*  DBMS       : MySql 						*/
/* ---------------------------------------------------- */

SET FOREIGN_KEY_CHECKS=0
; 
/* Drop Tables */

DROP TABLE IF EXISTS `address` CASCADE
;

DROP TABLE IF EXISTS `department` CASCADE
;

DROP TABLE IF EXISTS `doctor` CASCADE
;

DROP TABLE IF EXISTS `examination` CASCADE
;

DROP TABLE IF EXISTS `notification` CASCADE
;

DROP TABLE IF EXISTS `patient` CASCADE
;

DROP TABLE IF EXISTS `receptionist` CASCADE
;

DROP TABLE IF EXISTS `reservation` CASCADE
;

DROP TABLE IF EXISTS `role` CASCADE
;

DROP TABLE IF EXISTS `timetable` CASCADE
;

DROP TABLE IF EXISTS `user` CASCADE
;

/* Create Tables */

CREATE TABLE `address`
(
	`address_id` INT NOT NULL AUTO_INCREMENT,
	`street` NVARCHAR(100) NOT NULL,
	`number` NVARCHAR(50) NOT NULL,
	`city` NVARCHAR(100) NOT NULL,
	`zip_code` NVARCHAR(50) NOT NULL,
	CONSTRAINT `PK_address` PRIMARY KEY (`address_id` ASC)
)
COMMENT = 'Contains information about patient''s address.'

;

CREATE TABLE `department`
(
	`department_id` INT NOT NULL AUTO_INCREMENT,
	`name` NVARCHAR(50) NOT NULL,
	`description` NVARCHAR(250) NULL,
	CONSTRAINT `PK_department` PRIMARY KEY (`department_id` ASC)
)
COMMENT = 'Contains information about departments of the medical center.'

;

CREATE TABLE `doctor`
(
	`doctor_id` INT NOT NULL AUTO_INCREMENT,
	`user_id` INT NULL,
	`department_id` INT NULL,
	CONSTRAINT `PK_doctor` PRIMARY KEY (`doctor_id` ASC)
)
COMMENT = 'Represents doctor''s role within the system. Table is connected to the user table through its foreign key. doctor also carries foreign key to the department he/she is working at.'

;

CREATE TABLE `examination`
(
	`examination_id` INT NOT NULL AUTO_INCREMENT,
	`type` NVARCHAR(100) NOT NULL,
	`length` INT NOT NULL,
	`description` NVARCHAR(255) NULL,
	`department_id` INT NULL,
	CONSTRAINT `PK_examination` PRIMARY KEY (`examination_id` ASC)
)
COMMENT = 'Information about the examination - type, its length, department and optional description. examination is mandatory part of the reservation because it is mandatory to fill in examination type during the creation of a reservation. examinations are also connected to the departments so when a user is creating a reservation, only valid types of examinations will be offered by the system to choose. '

;

CREATE TABLE `notification`
(
	`notification_id` INT NOT NULL AUTO_INCREMENT,
	`timestamp` DATETIME(6) NOT NULL,
	`message` NVARCHAR(250) NOT NULL,
	`state` NVARCHAR(50) NOT NULL,
	`user_id` INT NULL,
	CONSTRAINT `PK_notification` PRIMARY KEY (`notification_id` ASC)
)
COMMENT = 'Table notification holds information and state of the particular notification which is strictly connected to the specific user.'

;

CREATE TABLE `patient`
(
	`patient_id` INT NOT NULL AUTO_INCREMENT,
	`birth_number` NVARCHAR(50) NOT NULL,
	`insurance` NVARCHAR(50) NOT NULL,
	`address_id` INT NULL,
	`user_id` INT NULL,
	CONSTRAINT `PK_patient` PRIMARY KEY (`patient_id` ASC)
)
COMMENT = 'Represents patient''s role within the system. Table is connected to the user table through its foreign key.'

;

CREATE TABLE `receptionist`
(
	`receptionist_id` INT NOT NULL AUTO_INCREMENT,
	`user_id` INT NULL,
	`department_id` INT NULL,
	CONSTRAINT `PK_receptionist` PRIMARY KEY (`receptionist_id` ASC)
)
COMMENT = 'Represents receptionist''s role within the system. Table is connected to the user table through its foreign key. receptionist also carries foreign key to the department he/she is working at.'

;

CREATE TABLE `reservation`
(
	`reservation_id` INT NOT NULL AUTO_INCREMENT,
	`date` DATE NOT NULL,
	`time_from` TIME(6) NOT NULL,
	`time_to` TIME(6) NOT NULL,
	`state` NVARCHAR(50) NOT NULL,
	`description` NVARCHAR(255) NULL,
	`patient_id` INT NULL,
	`doctor_id` INT NULL,
	`examination_id` INT NULL,
	CONSTRAINT `PK_reservation` PRIMARY KEY (`reservation_id` ASC)
)
COMMENT = 'Carries information about particular reservation. Each row defines some aspect of the reservation, including particular date and time interval (representing "Termin" domain from the package "Domenovy model").'

;

CREATE TABLE `role`
(
	`role_id` INT NOT NULL AUTO_INCREMENT,
	`name` NVARCHAR(50) NOT NULL,
	CONSTRAINT `PK_role` PRIMARY KEY (`role_id` ASC)
)
COMMENT = 'Table role holds names of roles and theirs ids. Each user is strictly defined by its role. role specifies user''s permissions and capabilities within the system. '

;

CREATE TABLE `timetable`
(
	`timetable_id` INT NOT NULL AUTO_INCREMENT,
	`date` DATE NOT NULL,
	`time_from` TIME(6) NOT NULL,
	`time_to` TIME(6) NOT NULL,
	`doctor_id` INT NULL,
	CONSTRAINT `PK_timetable` PRIMARY KEY (`timetable_id` ASC)
)
COMMENT = 'Contains information about working hours defined by doctors. Each row represent some particular day. System will be capable of determining when a doctor is or is not working.'

;

CREATE TABLE `user`
(
	`user_id` INT NOT NULL AUTO_INCREMENT,
	`active` BIT(1) NOT NULL,
	`username` NVARCHAR(50) NOT NULL,
	`password` NVARCHAR(50) NOT NULL,
	`email` NVARCHAR(50) NOT NULL,
	`first_name` NVARCHAR(50) NOT NULL,
	`last_name` NVARCHAR(50) NOT NULL,
	`phone` NVARCHAR(15) NULL,
	`role_id` INT NULL,
	CONSTRAINT `PK_user` PRIMARY KEY (`user_id` ASC)
)
COMMENT = 'Table user holds main information about each user. user is defined by its id and its unique username. Each role from role table also represents single table which carries specific information connected to the particular role. We can access role''s table using information from the role table joining through user''s primary key.'

;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE `department` 
 ADD CONSTRAINT `name` UNIQUE (`name` ASC)
;

ALTER TABLE `doctor` 
 ADD INDEX `IXFK_doctor_department` (`department_id` ASC)
;

ALTER TABLE `doctor` 
 ADD INDEX `IXFK_doctor_user` (`user_id` ASC)
;

ALTER TABLE `examination` 
 ADD INDEX `IXFK_examination_department` (`department_id` ASC)
;

ALTER TABLE `notification` 
 ADD INDEX `IXFK_notification_user` (`user_id` ASC)
;

ALTER TABLE `patient` 
 ADD INDEX `IXFK_patient_address` (`address_id` ASC)
;

ALTER TABLE `patient` 
 ADD INDEX `IXFK_patient_user` (`user_id` ASC)
;

ALTER TABLE `receptionist` 
 ADD INDEX `IXFK_receptionist_department` (`department_id` ASC)
;

ALTER TABLE `receptionist` 
 ADD INDEX `IXFK_receptionist_user` (`user_id` ASC)
;

ALTER TABLE `reservation` 
 ADD INDEX `IXFK_reservation_doctor` (`doctor_id` ASC)
;

ALTER TABLE `reservation` 
 ADD INDEX `IXFK_reservation_examination` (`examination_id` ASC)
;

ALTER TABLE `reservation` 
 ADD INDEX `IXFK_reservation_patient` (`patient_id` ASC)
;

ALTER TABLE `role` 
 ADD CONSTRAINT `UK_Name` UNIQUE (`name` ASC)
;

ALTER TABLE `timetable` 
 ADD INDEX `IXFK_timetable_doctor` (`doctor_id` ASC)
;

ALTER TABLE `user` 
 ADD CONSTRAINT `UK_username` UNIQUE (`username` ASC)
;

ALTER TABLE `user` 
 ADD INDEX `IXFK_user_role` (`role_id` ASC)
;

/* Create Foreign Key Constraints */

ALTER TABLE `doctor` 
 ADD CONSTRAINT `FK_doctor_department`
	FOREIGN KEY (`department_id`) REFERENCES `department` (`department_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `doctor` 
 ADD CONSTRAINT `FK_doctor_user`
	FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `examination` 
 ADD CONSTRAINT `FK_examination_department`
	FOREIGN KEY (`department_id`) REFERENCES `department` (`department_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `notification` 
 ADD CONSTRAINT `FK_notification_user`
	FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `patient` 
 ADD CONSTRAINT `FK_patient_address`
	FOREIGN KEY (`address_id`) REFERENCES `address` (`address_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `patient` 
 ADD CONSTRAINT `FK_patient_user`
	FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `receptionist` 
 ADD CONSTRAINT `FK_receptionist_department`
	FOREIGN KEY (`department_id`) REFERENCES `department` (`department_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `receptionist` 
 ADD CONSTRAINT `FK_receptionist_user`
	FOREIGN KEY (`user_id`) REFERENCES `user` (`user_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `reservation` 
 ADD CONSTRAINT `FK_reservation_doctor`
	FOREIGN KEY (`doctor_id`) REFERENCES `doctor` (`doctor_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `reservation` 
 ADD CONSTRAINT `FK_reservation_examination`
	FOREIGN KEY (`examination_id`) REFERENCES `examination` (`examination_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `reservation` 
 ADD CONSTRAINT `FK_reservation_patient`
	FOREIGN KEY (`patient_id`) REFERENCES `patient` (`patient_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `timetable` 
 ADD CONSTRAINT `FK_timetable_doctor`
	FOREIGN KEY (`doctor_id`) REFERENCES `doctor` (`doctor_id`) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE `user` 
 ADD CONSTRAINT `FK_user_role`
	FOREIGN KEY (`role_id`) REFERENCES `role` (`role_id`) ON DELETE No Action ON UPDATE No Action
;

SET FOREIGN_KEY_CHECKS=1
; 
